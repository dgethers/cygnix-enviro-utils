#!/bin/bash
export EDITOR=vi

# PS1

# green datetime; bold red cwd
PS1='[\l] \[\e[0;32m\]\D{%F %T}\[\e[m\] \[\e[1;31m\]\W\[\e[m\] '
if [[ "$TERM" == xterm* ]] ; then
  # set terminal title: user, host, cwd, terminal size
  TITLEBAR='\[\033]0;\u@\h:\w - ${COLUMNS}x${LINES}\007\]'
  PS1="$TITLEBAR$PS1"
  TITLEBAR=""
fi

# add git to ps1

if [[ -e "${HOME}"/bashrc.d/git-prompt.sh ]] ; then
  source "${HOME}"/bashrc.d/git-prompt.sh
  # in bold grey, parenthesized git prompt
  PS1="$PS1"'\[\e[1;30m\]$(__git_ps1 "(%s)")\[\e[m\]'
  # git prompt consists of:
  # branch name;
  # '*' for dirty state;
  # '+' for staged/uncommitted changes;
  # '%' for untracked files;
  # '=<>' if upstream is set for same as, behind, or ahead of upstream.
  GIT_PS1_SHOWDIRTYSTATE=x
  GIT_PS1_SHOWUPSTREAM=auto
  GIT_PS1_SHOWUNTRACKEDFILES=x
  # git prompt suppressed if you happen to navigate into an ignored
  # subdirectory.
  GIT_PS1_HIDE_IF_PWD_IGNORED=x
  # default char to separate branch name from dirty state details is space.
  #GIT_PS1_STATESEPARATOR=
else
  echo No bashrc.d/git-prompt.sh found: consider copying or linking from local git /etc resources
fi

if [[ -e "${HOME}"/bashrc.d/git-completion.bash ]] ; then
  source "${HOME}"/bashrc.d/git-completion.bash
else
  echo No bashrc.d/git-completion.bash found: consider copying or linking from local git /etc resources
fi

# finish up PS1 with a blue 
PS1="$PS1"'\[\e[1;34m\]$\[\e[m\] '


# LESSOPEN
# allow less to view gzip and several other non-ascii filetypes
_lesspipe="$(which lesspipe.sh)"
[[ ! -x "$_lesspipe" ]] || export LESSOPEN="|${_lesspipe} %s"

source_pragma_once ~/bashrc.d/*-env

# patch an iTerm2 issue that causes vim to misassign light/dark color scheme
[[ -n "$COLORFGBG" ]] || export COLORFGBG="15;0"
