#!/bin/bash

source_pragma_once ~/.sleeprc ##enable the builtin version of sleep

function addhost(){
    for x in "$@" ; do
      echo adding $x
      sed "s/%HOST%/$x/" ~/.ssh/config_template >>~/.ssh/config
    done
}

function cdsrc() {
  envi="$1" ; shift
  c "$SRC/${envi}/projects" "$@"
  return $?
}


function c(){
  DIR="$1"
  shift
  if [[ ! -d "$DIR" ]] ; then
    mkdir -pv "$DIR" >&2
    RESULT=$?
    [[ $RESULT == 0 ]] || return $RESULT
  fi
  echo "$DIR" >&2
  if [[ -z "$*" ]] ; then
    cd "$DIR"
  else
    ( cd "$DIR" && "$@" )
  fi
}

function ppid() {
  local PID=$$ ; ps -p $(cat /proc/$PID/ppid)
}

function create_alias() {
  for x ; do
    echo alias "'$x'" >>~/bashrc.d/alias
    source ~/bashrc.d/alias
  done
}

function code() {
  suff="${1:-wc}"
  folders=(~/code/*"$suff")
  numf="${#folders[@]}"
  case "$numf" in
    1) ;;
    *)
        echo >/dev/tty "$numf" folders found for \*"$suff", please be more specific:
	for folder in "${folders[@]}" ; do
           echo >/dev/tty -e "\\t$folder"
        done
	return 2 ;;
  esac
  for folder in "${folders[@]}" ; do
    [[ -d "$folder" ]] && c "$folder" || \
         { echo >/dev/tty 'No folder found for *'"$suff" ; return 1 ;}
    [[ ! -d .git ]] || git status
  done

}
